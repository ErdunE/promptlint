const F="modulepreload",j=function(o){return"/"+o},N={},P=function(e,t,n){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),a=s?.nonce||s?.getAttribute("nonce");i=Promise.allSettled(t.map(l=>{if(l=j(l),l in N)return;N[l]=!0;const c=l.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const m=document.createElement("link");if(m.rel=c?"stylesheet":F,c||(m.as="script"),m.crossOrigin="",m.href=l,a&&m.setAttribute("nonce",a),document.head.appendChild(m),c)return new Promise((y,p)=>{m.addEventListener("load",y),m.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${l}`)))})}))}function r(s){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s}return i.then(s=>{for(const a of s||[])a.status==="rejected"&&r(a.reason);return e().catch(r)})};var b=(o=>(o.CHATGPT="chatgpt",o.CLAUDE="claude",o))(b||{}),w=(o=>(o.SITE_NOT_DETECTED="site_not_detected",o.ELEMENT_NOT_FOUND="element_not_found",o.SELECTOR_INVALID="selector_invalid",o.TIMEOUT="timeout",o.VALIDATION_FAILED="validation_failed",o.INITIALIZATION_FAILED="initialization_failed",o))(w||{});class T extends Error{constructor(e,t,n){super(t),this.type=e,this.context=n,this.name="AdapterError"}}const $={maxRetries:3,baseDelay:100,exponentialBackoff:!0,maxTimeout:5e3};class D{constructor(e,t){this.config=e,this.fallbackConfig={...$,...t}}fallbackConfig;initialized=!1;get siteType(){return this.config.type}async detectSite(e){const t=performance.now(),n=e||window.location.href;try{const i=this.config.urlPatterns.some(l=>l.test(n));if(!i)return{type:null,confidence:0,url:n,metadata:{reason:"url_pattern_mismatch"}};const r=await this.performAdditionalDetection(),s=performance.now()-t,a=i?Math.min(.8+r,1):0;return{type:a>.5?this.config.type:null,confidence:a,url:n,metadata:{detectionTime:s,urlMatch:i,additionalConfidence:r}}}catch(i){const r=performance.now()-t;return{type:null,confidence:0,url:n,metadata:{detectionTime:r,error:i instanceof Error?i.message:"Unknown error"}}}}async findInputElement(){return this.findElementWithFallback(this.config.inputSelector,"input")}async findSubmitElement(){return this.findElementWithFallback(this.config.submitSelector,"submit")}async findChatContainer(){return this.findElementWithFallback(this.config.chatContainerSelector,"chatContainer")}async findInjectionPoint(){return this.findElementWithFallback(this.config.injectionPointSelector,"injectionPoint")}async initialize(){if(!this.initialized)try{await this.performInitialization(),this.initialized=!0}catch(e){throw new T(w.INITIALIZATION_FAILED,`Failed to initialize ${this.config.type} adapter: ${e instanceof Error?e.message:"Unknown error"}`,{siteType:this.config.type,error:e})}}cleanup(){this.performCleanup(),this.initialized=!1}async findElementWithFallback(e,t){const n=performance.now();let i=await this.findElementWithRetry(e.primary,e.validator);if(i)return{element:i,selectorUsed:"primary",findTime:performance.now()-n,isValid:e.validator?e.validator(i):!0};for(let r=0;r<e.fallbacks.length;r++){const s=e.fallbacks[r];if(i=await this.findElementWithRetry(s,e.validator),i){const a=e.validator?e.validator(i):!0;return{element:i,selectorUsed:r,findTime:performance.now()-n,isValid:a}}}return{element:null,selectorUsed:"primary",findTime:performance.now()-n,isValid:!1}}async findElementWithRetry(e,t){let n=0;const i=Date.now(),r=typeof process<"u"&&!1,s=this.fallbackConfig.maxRetries,a=this.fallbackConfig.maxTimeout;for(;n<s&&!(Date.now()-i>a);){try{const l=document.querySelector(e);if(l&&(r||!t||t(l)))return l}catch{break}if(n<s-1){const l=this.fallbackConfig.baseDelay,c=this.fallbackConfig.exponentialBackoff?l*Math.pow(2,n):l;await this.sleep(c)}n++}return null}sleep(e){return new Promise(t=>setTimeout(t,e))}waitForDOM(){return new Promise(e=>{document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>e(),{once:!0}):e()})}waitForElement(e,t=5e3,n){return new Promise(i=>{const r=Date.now(),s=()=>{const a=document.querySelector(e);if(a&&(!n||n(a))){i(a);return}if(Date.now()-r>=t){i(null);return}setTimeout(s,100)};s()})}isTestEnvironment(){return typeof process<"u"&&!1}}const A={[b.CHATGPT]:[/^https?:\/\/chat\.openai\.com/i,/^https?:\/\/chatgpt\.com/i,/^https?:\/\/.*\.openai\.com\/chat/i],[b.CLAUDE]:[/^https?:\/\/claude\.ai/i,/^https?:\/\/.*\.anthropic\.com/i,/^https?:\/\/console\.anthropic\.com/i]},G={[b.CHATGPT]:{selectors:['[data-testid="chat-input"]','textarea[placeholder*="Message ChatGPT"]',".text-base.gap-6",'[data-testid="send-button"]'],textContent:["ChatGPT","OpenAI"],attributes:[{selector:'meta[property="og:site_name"]',attribute:"content",value:/ChatGPT|OpenAI/i}]},[b.CLAUDE]:{selectors:['[data-testid="chat-input"]','textarea[placeholder*="Talk with Claude"]',".claude-chat",'[data-testid="send-message"]'],textContent:["Claude","Anthropic"],attributes:[{selector:'meta[property="og:site_name"]',attribute:"content",value:/Claude|Anthropic/i}]}};class V{detectionCache=new Map;cacheTimeout=3e4;async detectSite(e){const t=performance.now(),n=e||(typeof window<"u"?window.location.href:""),i=this.getCachedResult(n);if(i)return{...i,metadata:{...i.metadata,fromCache:!0,detectionTime:performance.now()-t}};try{const r=await this.performDetection(n,t);return r.confidence>.5&&this.setCachedResult(n,r),r}catch(r){const s=performance.now()-t;return{type:null,confidence:0,url:n,metadata:{detectionTime:s,error:r instanceof Error?r.message:"Unknown error"}}}}async performDetection(e,t){let n=null,i=0,r={};for(const a of Object.values(b)){const{confidence:l,metadata:c}=await this.testSiteType(a,e);l>i&&(n=a,i=l,r={...r,[`${a}_detection`]:c})}const s=performance.now()-t;return{type:i>.5?n:null,confidence:i,url:e,metadata:{detectionTime:s,...r,allScores:r}}}async testSiteType(e,t){let n=0;const i={};if(A[e].some(a=>a.test(t))&&(n+=.7,i.urlMatch=!0),typeof document<"u"){const a=await this.testDOMPatterns(e);n+=a*.3,i.domConfidence=a}else i.domConfidence=0;return{confidence:Math.min(n,1),metadata:i}}async testDOMPatterns(e){const t=G[e];let n=0,i=0;if(t.selectors)for(const r of t.selectors){i++;try{document.querySelector(r)&&n++}catch{}}if(t.textContent){i++;const r=document.body?.textContent?.toLowerCase()||"";t.textContent.some(s=>r.includes(s.toLowerCase()))&&n++}if(t.attributes)for(const{selector:r,attribute:s,value:a}of t.attributes){i++;try{const c=document.querySelector(r)?.getAttribute(s);c&&a.test(c)&&n++}catch{}}return i>0?n/i:0}async isSiteSupported(e){const t=await this.detectSite(e);return t.type!==null&&t.confidence>.5}getSupportedSites(){return Object.values(b)}getUrlPatterns(e){return[...A[e]]}clearCache(){this.detectionCache.clear()}getCachedResult(e){const t=this.detectionCache.get(e);return t?Date.now()-(t.metadata?.cacheTime||0)>this.cacheTimeout?(this.detectionCache.delete(e),null):t:null}setCachedResult(e,t){const n={...t,metadata:{...t.metadata,cacheTime:Date.now()}};this.detectionCache.set(e,n)}}const v=new V;class M{adapters=new Map;initialized=!1;register(e){if(this.adapters.has(e.siteType))throw new T(w.INITIALIZATION_FAILED,`Adapter for ${e.siteType} is already registered`,{siteType:e.siteType});this.adapters.set(e.siteType,e)}async getAdapter(e){const t=await v.detectSite(e);if(!t.type||t.confidence<.5)return null;const n=this.adapters.get(t.type);if(!n)throw new T(w.SITE_NOT_DETECTED,`No adapter registered for site type: ${t.type}`,{siteType:t.type,detection:t});return n}getAllAdapters(){return Array.from(this.adapters.values())}async isSiteSupported(e){const t=await v.detectSite(e);return t.type!==null&&t.confidence>.5&&this.adapters.has(t.type)}getAdapterByType(e){return this.adapters.get(e)||null}hasAdapter(e){return this.adapters.has(e)}getRegisteredSiteTypes(){return Array.from(this.adapters.keys())}async initializeAll(){if(this.initialized)return;const e=this.getAllAdapters().map(async t=>{try{await t.initialize()}catch(n){throw console.warn(`Failed to initialize ${t.siteType} adapter:`,n),new T(w.INITIALIZATION_FAILED,`Failed to initialize ${t.siteType} adapter`,{siteType:t.siteType,error:n})}});await Promise.all(e),this.initialized=!0}cleanupAll(){for(const e of this.getAllAdapters())try{e.cleanup()}catch(t){console.warn(`Failed to cleanup ${e.siteType} adapter:`,t)}this.initialized=!1}unregister(e){const t=this.adapters.get(e);if(t){try{t.cleanup()}catch(n){console.warn(`Failed to cleanup ${e} adapter during unregister:`,n)}return this.adapters.delete(e)}return!1}clear(){this.cleanupAll(),this.adapters.clear()}getStats(){return{totalAdapters:this.adapters.size,registeredSites:this.getRegisteredSiteTypes(),initialized:this.initialized}}}const C=new M,B=Object.freeze(Object.defineProperty({__proto__:null,AdapterRegistry:M,adapterRegistry:C},Symbol.toStringTag,{value:"Module"})),L={input:{primary:"#prompt-textarea",fallbacks:['textarea[data-testid="chat-input"]','textarea[placeholder*="Message ChatGPT"]','textarea[placeholder*="Send a message"]','.ProseMirror[contenteditable="true"]','div[contenteditable="true"][data-testid="chat-input"]',"textarea.m-0","form textarea:not([disabled])"],validator:o=>{const e=o;if(!e.offsetParent)return!1;const t=e.getAttribute("role")==="textbox"||e.tagName.toLowerCase()==="textarea",n=e.getAttribute("placeholder")?.toLowerCase().includes("message")||e.getAttribute("placeholder")?.toLowerCase().includes("send"),i=e.getAttribute("contenteditable")==="true";return t||n||i},description:"Main chat input textarea"},submit:{primary:'button[data-testid="send-button"]',fallbacks:['button[aria-label*="Send message"]','button[aria-label*="Send"]','form button[type="submit"]','button:has(svg[data-icon="send"])',".btn-primary:last-of-type","button.absolute.p-1.rounded-md",'button[disabled]:has-text("Send")',"form button:not([disabled]):last-child"],validator:o=>{const e=o;if(e.tagName.toLowerCase()!=="button")return!1;const t=e.getAttribute("aria-label")?.toLowerCase(),n=t?.includes("send")||t?.includes("submit"),i=e.querySelector("svg")!==null,r=e.classList.contains("absolute")||e.closest("form")?.lastElementChild===e;return n||i||r},description:"Send message button"},chatContainer:{primary:'main[class*="conversation"]',fallbacks:[".conversation-turn-container",'[data-testid="conversation-turn"]',".text-base.gap-6","main.relative.h-full",".flex.flex-col.text-sm",'div[class*="chat"]','main div[class*="conversation"]',".overflow-hidden.w-full.h-full.relative.flex"],validator:o=>{const e=o.querySelectorAll('[data-testid*="conversation"], .conversation, [class*="message"]').length>0,t=o.tagName.toLowerCase()==="main",n=o.scrollHeight>o.clientHeight;return e||t||n},description:"Main chat conversation container"},injectionPoint:{primary:'form[class*="stretch"]',fallbacks:["form:has(textarea)",".relative.flex.h-full.flex-1.flex-col","main.relative.h-full",'div[class*="composer"]',".flex.w-full.items-center","form.flex.flex-row.gap-3","body > div:first-child","#__next"],validator:o=>{const e=o.querySelector('textarea, [contenteditable="true"]')!==null,t=o.tagName.toLowerCase()==="form"||o.querySelector("form")!==null,n=o.getBoundingClientRect().bottom>window.innerHeight*.5;return e||t||n},description:"UI injection point for floating panel"}},W={type:b.CHATGPT,urlPatterns:[/^https?:\/\/chat\.openai\.com/i,/^https?:\/\/chatgpt\.com/i,/^https?:\/\/.*\.openai\.com\/chat/i],inputSelector:L.input,submitSelector:L.submit,chatContainerSelector:L.chatContainer,injectionPointSelector:L.injectionPoint,metadata:{displayName:"ChatGPT",iconUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDJMMTMuMDkgOC4yNkwyMCA5TDEzLjA5IDE1Ljc0TDEyIDIyTDEwLjkxIDE1Ljc0TDQgOUwxMC45MSA4LjI2TDEyIDJaIiBmaWxsPSIjMDBBNjdFIi8+Cjwvc3ZnPgo=",settings:{supportsStreaming:!0,hasCodeExecution:!0,hasFileUpload:!0}}};class k extends D{constructor(){super(W)}async performAdditionalDetection(){let e=0;const t=['meta[property="og:title"][content*="ChatGPT"]','title:contains("ChatGPT")','[data-testid="chat-input"]',".text-token-text-primary"];let n=0;for(const r of t)try{document.querySelector(r)&&n++}catch{}e+=n/t.length*.15;const i=document.body?.textContent?.toLowerCase()||"";return(i.includes("openai")||i.includes("chatgpt"))&&(e+=.05),Math.min(e,.2)}async performInitialization(){await this.waitForDOM(),this.isTestEnvironment()||(await this.waitForElement('textarea, [contenteditable="true"]',1e4),this.setupDynamicContentObserver()),console.log("ChatGPT adapter initialized successfully")}performCleanup(){console.log("ChatGPT adapter cleaned up")}setupDynamicContentObserver(){const e=new MutationObserver(t=>{for(const n of t)n.type==="childList"&&n.addedNodes.length>0&&console.debug("ChatGPT content updated")});e.observe(document.body,{childList:!0,subtree:!0}),this._contentObserver=e}cleanup(){const e=this._contentObserver;e&&(e.disconnect(),delete this._contentObserver),super.cleanup()}}const q=new k,H=Object.freeze(Object.defineProperty({__proto__:null,ChatGPTAdapter:k,chatgptAdapter:q},Symbol.toStringTag,{value:"Module"})),x={input:{primary:'div[contenteditable="true"][data-testid="chat-input"]',fallbacks:['textarea[placeholder*="Talk with Claude"]','textarea[placeholder*="Message Claude"]','div[contenteditable="true"].ProseMirror','[data-testid="message-input"]',".composer textarea",'div[role="textbox"][contenteditable="true"]',"textarea:not([disabled]):last-of-type",'form div[contenteditable="true"]'],validator:o=>{const e=o;if(!e.offsetParent)return!1;const t=e.getAttribute("contenteditable")==="true",n=e.tagName.toLowerCase()==="textarea",i=e.getAttribute("role")==="textbox",r=e.getAttribute("placeholder")?.toLowerCase().includes("claude")||e.getAttribute("placeholder")?.toLowerCase().includes("talk")||e.getAttribute("placeholder")?.toLowerCase().includes("message"),s=e.classList.contains("ProseMirror")||e.querySelector(".ProseMirror")!==null;return(t||n||i)&&(r||s)},description:"Main chat input (contenteditable div or textarea)"},submit:{primary:'button[data-testid="send-message"]',fallbacks:['button[aria-label*="Send message"]','button[aria-label*="Send"]','form button[type="submit"]','button:has(svg[data-icon="send"])','button:has(svg[data-testid="send-icon"])',".send-button","button.bg-accent-main-100","form button:not([disabled]):last-child"],validator:o=>{const e=o;if(e.tagName.toLowerCase()!=="button")return!1;const t=e.getAttribute("aria-label")?.toLowerCase(),n=t?.includes("send")||t?.includes("submit"),i=e.querySelector('svg[data-testid*="send"], svg[data-icon*="send"]')!==null,r=e.classList.contains("bg-accent-main-100")||e.classList.contains("send-button"),s=e.closest("form")?.lastElementChild===e;return n||i||r||s},description:"Send message button"},chatContainer:{primary:'div[data-testid="chat-messages"]',fallbacks:[".conversation-container",'[data-testid="conversation"]','main div[class*="messages"]',".chat-messages",'div[class*="conversation"]',"main.flex.flex-col",'.overflow-y-auto:has([data-testid*="message"])','div:has(> div[data-testid*="message"])'],validator:o=>{const e=o.querySelectorAll('[data-testid*="message"], .message, [class*="message"]').length>0,t=o.scrollHeight>o.clientHeight,n=o.children.length>1;return e||t||n},description:"Main chat messages container"},injectionPoint:{primary:'div[class*="composer"]',fallbacks:['form:has(div[contenteditable="true"])',"form:has(textarea)",".message-input-container",'div:has([data-testid="chat-input"])',"main > div:last-child",".flex.flex-col.gap-2:has(textarea)",'body > div[id^="__next"]',"main.relative"],validator:o=>{const e=o.querySelector('textarea, [contenteditable="true"]')!==null,t=o.classList.toString().includes("composer")||o.querySelector('[class*="composer"]')!==null,n=o.getBoundingClientRect().bottom>window.innerHeight*.4;return e||t||n},description:"UI injection point for floating panel"}},Z={type:b.CLAUDE,urlPatterns:[/^https?:\/\/claude\.ai/i,/^https?:\/\/.*\.anthropic\.com/i,/^https?:\/\/console\.anthropic\.com/i],inputSelector:x.input,submitSelector:x.submit,chatContainerSelector:x.chatContainer,injectionPointSelector:x.injectionPoint,metadata:{displayName:"Claude",iconUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iMTAiIGZpbGw9IiNEOTdCMDAiLz4KPHBhdGggZD0iTTggMTJMMTIgOEwxNiAxMkwxMiAxNkw4IDEyWiIgZmlsbD0iI0ZGRkZGRiIvPgo8L3N2Zz4K",settings:{supportsStreaming:!0,hasCodeExecution:!1,hasFileUpload:!0,usesContentEditable:!0}}};class z extends D{constructor(){super(Z)}async performAdditionalDetection(){let e=0;const t=['meta[property="og:title"][content*="Claude"]','title:contains("Claude")','[data-testid="chat-input"]',".ProseMirror",'[class*="anthropic"]'];let n=0;for(const r of t)try{document.querySelector(r)&&n++}catch{}e+=n/t.length*.15;const i=document.body?.textContent?.toLowerCase()||"";return(i.includes("anthropic")||i.includes("claude"))&&(e+=.05),Math.min(e,.2)}async performInitialization(){await this.waitForDOM(),this.isTestEnvironment()||(await this.waitForElement('div[contenteditable="true"], textarea',1e4),this.setupDynamicContentObserver(),await this.initializeProseMirrorSupport()),console.log("Claude adapter initialized successfully")}performCleanup(){console.log("Claude adapter cleaned up")}setupDynamicContentObserver(){const e=new MutationObserver(t=>{for(const n of t)n.type==="childList"&&n.addedNodes.length>0&&console.debug("Claude content updated")});e.observe(document.body,{childList:!0,subtree:!0}),this._contentObserver=e}async initializeProseMirrorSupport(){const e=await this.waitForElement(".ProseMirror",5e3);e&&(console.debug("ProseMirror editor detected and initialized"),this._proseMirrorEditor=e)}cleanup(){const e=this._contentObserver;e&&(e.disconnect(),delete this._contentObserver),delete this._proseMirrorEditor,super.cleanup()}async getInputText(){const e=await this.findInputElement();if(!e.element)return"";const t=e.element;return t.getAttribute("contenteditable")==="true"?t.textContent||"":t.tagName.toLowerCase()==="textarea"&&t.value||""}async setInputText(e){const t=await this.findInputElement();if(!t.element)return!1;const n=t.element;try{if(n.getAttribute("contenteditable")==="true")return n.textContent=e,n.dispatchEvent(new Event("input",{bubbles:!0})),!0;if(n.tagName.toLowerCase()==="textarea"){const i=n;return i.value=e,i.dispatchEvent(new Event("input",{bubbles:!0})),!0}}catch(i){console.warn("Failed to set input text:",i)}return!1}}const K=new z,J=Object.freeze(Object.defineProperty({__proto__:null,ClaudeAdapter:z,claudeAdapter:K},Symbol.toStringTag,{value:"Module"}));function Y(o){const e=o;if(!e.offsetParent&&e.offsetWidth===0&&e.offsetHeight===0)return!1;const t=window.getComputedStyle(e);return!(t.display==="none"||t.visibility==="hidden"||t.opacity==="0")}function Q(o){const e=o;return!("disabled"in e&&e.disabled||"readOnly"in e&&e.readOnly||e.getAttribute("aria-disabled")==="true")}const X={maxAttempts:3,baseDelay:100,exponentialBackoff:!0,maxTimeout:5e3,validateElements:!0};class ee{strategy;constructor(e={}){this.strategy={...X,...e}}async findElement(e){const t=performance.now();let n=0;const i=await this.trySelector(e.primary,e.validator,0);if(n+=i.attempts,i.element)return{element:i.element,successfulSelector:e.primary,selectorIndex:0,totalTime:performance.now()-t,attempts:n,isValid:i.isValid,...i.error&&{error:i.error}};for(let r=0;r<e.fallbacks.length;r++){const s=e.fallbacks[r],a=await this.trySelector(s,e.validator,r+1);if(n+=a.attempts,a.element)return{element:a.element,successfulSelector:s,selectorIndex:r+1,totalTime:performance.now()-t,attempts:n,isValid:a.isValid,...a.error&&{error:a.error}};if(performance.now()-t>this.strategy.maxTimeout)break}return{element:null,successfulSelector:null,selectorIndex:-1,totalTime:performance.now()-t,attempts:n,isValid:!1,error:new T(w.ELEMENT_NOT_FOUND,`Failed to find element after trying ${e.fallbacks.length+1} selectors`,{primarySelector:e.primary,fallbackSelectors:e.fallbacks,description:e.description})}}async trySelector(e,t,n=0){let i=0,r;for(;i<this.strategy.maxAttempts;){try{const s=document.querySelector(e);if(s){if(this.strategy.validateElements){if(!Y(s)){i++,await this.delay(i);continue}if(!Q(s)){i++,await this.delay(i);continue}}if(t?t(s):!0)return{element:s,attempts:i+1,isValid:!0}}}catch(s){r=s instanceof Error?s:new Error("Unknown selector error");break}i++,i<this.strategy.maxAttempts&&await this.delay(i)}return{element:null,attempts:i,isValid:!1,...r&&{error:r}}}async delay(e){const t=this.strategy.exponentialBackoff?this.strategy.baseDelay*Math.pow(2,e-1):this.strategy.baseDelay;return new Promise(n=>setTimeout(n,Math.min(t,1e3)))}updateStrategy(e){this.strategy={...this.strategy,...e}}getStrategy(){return{...this.strategy}}}new ee;async function te(){const{adapterRegistry:o}=await P(async()=>{const{adapterRegistry:n}=await Promise.resolve().then(()=>B);return{adapterRegistry:n}},void 0),{chatgptAdapter:e}=await P(async()=>{const{chatgptAdapter:n}=await Promise.resolve().then(()=>H);return{chatgptAdapter:n}},void 0),{claudeAdapter:t}=await P(async()=>{const{claudeAdapter:n}=await Promise.resolve().then(()=>J);return{claudeAdapter:n}},void 0);o.register(e),o.register(t),await o.initializeAll()}class S{panel=null;scoreElement=null;issuesContainer=null;isVisible=!1;options;constructor(e={}){this.options={position:e.position||"bottom-right",autoHide:e.autoHide!==!1,animationDuration:e.animationDuration||200}}async initialize(){try{this.createPanel(),this.attachStyles(),console.log("[PromptLint] Floating panel initialized")}catch(e){throw console.error("[PromptLint] Failed to initialize floating panel:",e),e}}createPanel(){this.panel=document.createElement("div"),this.panel.id="promptlint-floating-panel",this.panel.className=`promptlint-panel promptlint-panel--${this.options.position}`;const e=document.createElement("div");e.className="promptlint-panel__header";const t=document.createElement("div");t.className="promptlint-panel__title",t.textContent="PromptLint",this.scoreElement=document.createElement("div"),this.scoreElement.className="promptlint-panel__score",this.scoreElement.textContent="--",e.appendChild(t),e.appendChild(this.scoreElement),this.issuesContainer=document.createElement("div"),this.issuesContainer.className="promptlint-panel__issues";const n=document.createElement("button");n.className="promptlint-panel__toggle",n.innerHTML="−",n.addEventListener("click",()=>this.toggleCollapse()),e.appendChild(n),this.panel.appendChild(e),this.panel.appendChild(this.issuesContainer),this.panel.style.display="none",document.body.appendChild(this.panel)}attachStyles(){if(document.getElementById("promptlint-panel-styles"))return;const e=document.createElement("style");e.id="promptlint-panel-styles",e.textContent=this.getPanelCSS(),document.head.appendChild(e)}getPanelCSS(){return`
      .promptlint-panel {
        position: fixed;
        z-index: 10000;
        background: #ffffff;
        border: 1px solid #e1e5e9;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        font-size: 14px;
        min-width: 280px;
        max-width: 320px;
        transition: all ${this.options.animationDuration}ms ease;
      }

      .promptlint-panel--bottom-right {
        bottom: 20px;
        right: 20px;
      }

      .promptlint-panel--top-right {
        top: 20px;
        right: 20px;
      }

      .promptlint-panel--bottom-left {
        bottom: 20px;
        left: 20px;
      }

      .promptlint-panel--top-left {
        top: 20px;
        left: 20px;
      }

      .promptlint-panel__header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 16px;
        background: #f8f9fa;
        border-bottom: 1px solid #e1e5e9;
        border-radius: 8px 8px 0 0;
      }

      .promptlint-panel__title {
        font-weight: 600;
        color: #1a1a1a;
        font-size: 13px;
      }

      .promptlint-panel__score {
        font-weight: 700;
        font-size: 16px;
        padding: 4px 8px;
        border-radius: 4px;
        min-width: 32px;
        text-align: center;
      }

      .promptlint-panel__score--excellent {
        background: #d4edda;
        color: #155724;
      }

      .promptlint-panel__score--good {
        background: #d1ecf1;
        color: #0c5460;
      }

      .promptlint-panel__score--fair {
        background: #fff3cd;
        color: #856404;
      }

      .promptlint-panel__score--poor {
        background: #f8d7da;
        color: #721c24;
      }

      .promptlint-panel__toggle {
        background: none;
        border: none;
        font-size: 16px;
        cursor: pointer;
        padding: 4px;
        color: #6c757d;
        border-radius: 2px;
      }

      .promptlint-panel__toggle:hover {
        background: #e9ecef;
      }

      .promptlint-panel__issues {
        padding: 0;
        max-height: 300px;
        overflow-y: auto;
      }

      .promptlint-panel__issue {
        padding: 12px 16px;
        border-bottom: 1px solid #f1f3f4;
        display: flex;
        align-items: flex-start;
        gap: 8px;
      }

      .promptlint-panel__issue:last-child {
        border-bottom: none;
      }

      .promptlint-panel__issue-icon {
        flex-shrink: 0;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        margin-top: 2px;
      }

      .promptlint-panel__issue-icon--high {
        background: #dc3545;
      }

      .promptlint-panel__issue-icon--medium {
        background: #ffc107;
      }

      .promptlint-panel__issue-icon--low {
        background: #17a2b8;
      }

      .promptlint-panel__issue-content {
        flex: 1;
      }

      .promptlint-panel__issue-title {
        font-weight: 500;
        color: #1a1a1a;
        margin-bottom: 2px;
        font-size: 13px;
      }

      .promptlint-panel__issue-description {
        color: #6c757d;
        font-size: 12px;
        line-height: 1.4;
      }

      .promptlint-panel__no-issues {
        padding: 16px;
        text-align: center;
        color: #28a745;
        font-weight: 500;
        font-size: 13px;
      }

      .promptlint-panel--collapsed .promptlint-panel__issues {
        display: none;
      }

      .promptlint-panel--collapsed .promptlint-panel__toggle {
        transform: rotate(180deg);
      }

      /* Animation states */
      .promptlint-panel--entering {
        opacity: 0;
        transform: translateY(10px);
      }

      .promptlint-panel--entered {
        opacity: 1;
        transform: translateY(0);
      }

      .promptlint-panel--exiting {
        opacity: 0;
        transform: translateY(10px);
      }
    `}updateResults(e){if(!this.panel||!this.scoreElement||!this.issuesContainer){console.warn("[PromptLint] Panel not initialized");return}this.updateScore(e.score),this.updateIssues(e.issues),this.options.autoHide?e.issues.length>0?this.show():(this.show(),setTimeout(()=>this.hide(),2e3)):this.show()}updateScore(e){this.scoreElement&&(this.scoreElement.textContent=e.toString(),this.scoreElement.className="promptlint-panel__score",e>=85?this.scoreElement.classList.add("promptlint-panel__score--excellent"):e>=70?this.scoreElement.classList.add("promptlint-panel__score--good"):e>=50?this.scoreElement.classList.add("promptlint-panel__score--fair"):this.scoreElement.classList.add("promptlint-panel__score--poor"))}updateIssues(e){if(this.issuesContainer){if(this.issuesContainer.innerHTML="",e.length===0){const t=document.createElement("div");t.className="promptlint-panel__no-issues",t.textContent="✓ Great prompt quality!",this.issuesContainer.appendChild(t);return}e.forEach(t=>{const n=document.createElement("div");n.className="promptlint-panel__issue";const i=document.createElement("div");i.className=`promptlint-panel__issue-icon promptlint-panel__issue-icon--${t.severity}`;const r=document.createElement("div");r.className="promptlint-panel__issue-content";const s=document.createElement("div");s.className="promptlint-panel__issue-title",s.textContent=this.getIssueTitle(t);const a=document.createElement("div");a.className="promptlint-panel__issue-description",a.textContent=t.message,r.appendChild(s),r.appendChild(a),n.appendChild(i),n.appendChild(r),this.issuesContainer.appendChild(n)})}}getIssueTitle(e){return{missing_task_verb:"Missing Action Verb",missing_language:"Missing Programming Language",missing_io_specification:"Missing Input/Output Details",vague_wording:"Vague Language",unclear_scope:"Unclear Scope",redundant_language:"Redundant Wording"}[e.type]||"Quality Issue"}show(){!this.panel||this.isVisible||(this.panel.style.display="block",this.panel.classList.add("promptlint-panel--entering"),requestAnimationFrame(()=>{this.panel&&(this.panel.classList.remove("promptlint-panel--entering"),this.panel.classList.add("promptlint-panel--entered"))}),this.isVisible=!0)}hide(){!this.panel||!this.isVisible||(this.panel.classList.remove("promptlint-panel--entered"),this.panel.classList.add("promptlint-panel--exiting"),setTimeout(()=>{this.panel&&(this.panel.style.display="none",this.panel.classList.remove("promptlint-panel--exiting"))},this.options.animationDuration),this.isVisible=!1)}toggleCollapse(){if(!this.panel)return;this.panel.classList.toggle("promptlint-panel--collapsed");const e=this.panel.querySelector(".promptlint-panel__toggle");e&&(e.innerHTML=this.panel.classList.contains("promptlint-panel--collapsed")?"+":"−")}async cleanup(){this.panel&&(this.panel.remove(),this.panel=null);const e=document.getElementById("promptlint-panel-styles");e&&e.remove(),this.scoreElement=null,this.issuesContainer=null,this.isVisible=!1,console.log("[PromptLint] Floating panel cleaned up")}}class ne{adapter;options;floatingPanel=null;injectionPoint=null;isInitialized=!1;constructor(e,t={}){this.adapter=e,this.options={panelOptions:t.panelOptions||{},autoPosition:t.autoPosition!==!1,respectSiteStyles:t.respectSiteStyles!==!1}}async initialize(){if(this.isInitialized){console.log("[PromptLint] UI Injector already initialized");return}try{console.log("[PromptLint] Initializing UI injector...");const e=await this.adapter.findInjectionPoint();e.element?(this.injectionPoint=e.element,console.log("[PromptLint] Found injection point:",e.selectorUsed)):(console.warn("[PromptLint] No UI injection point found, using fallback"),this.injectionPoint=document.body);const t=this.determineOptimalPosition(),n={...this.options.panelOptions,position:t};this.floatingPanel=new S(n),await this.floatingPanel.initialize(),this.isInitialized=!0,console.log("[PromptLint] UI injector initialized successfully")}catch(e){throw console.error("[PromptLint] Failed to initialize UI injector:",e),e}}determineOptimalPosition(){if(!this.options.autoPosition)return this.options.panelOptions?.position||"bottom-right";try{const e=this.adapter.findInputElement();if(!e.element)return"bottom-right";const t=e.element.getBoundingClientRect(),n=window.innerWidth,i=window.innerHeight,r=t.right<n*.7,s=t.bottom<i*.7;return r&&s?"bottom-right":r&&!s?"top-right":!r&&s?"bottom-left":"top-left"}catch(e){return console.warn("[PromptLint] Error determining position, using default:",e),"bottom-right"}}async updateResults(e){if(!this.floatingPanel){console.warn("[PromptLint] Floating panel not initialized");return}try{this.floatingPanel.updateResults(e),console.log("[PromptLint] UI updated with results:",{score:e.score,issueCount:e.issues.length,processingTime:e.metadata?.processingTime})}catch(t){console.error("[PromptLint] Error updating UI with results:",t)}}async showPanel(){this.floatingPanel&&this.floatingPanel.show()}async hidePanel(){this.floatingPanel&&this.floatingPanel.hide()}async repositionPanel(){if(!(!this.floatingPanel||!this.options.autoPosition))try{const e=this.determineOptimalPosition(),t=this.floatingPanel,n={...this.options.panelOptions,position:e};await t.cleanup(),this.floatingPanel=new S(n),await this.floatingPanel.initialize(),console.log("[PromptLint] Panel repositioned to:",e)}catch(e){console.error("[PromptLint] Error repositioning panel:",e)}}async handleContentChange(){try{if(console.log("[PromptLint] Handling content change..."),this.injectionPoint&&!document.contains(this.injectionPoint)){console.log("[PromptLint] Injection point removed, finding new one...");const e=await this.adapter.findInjectionPoint();e.element?this.injectionPoint=e.element:this.injectionPoint=document.body}await this.repositionPanel()}catch(e){console.error("[PromptLint] Error handling content change:",e)}}getStatus(){return{isInitialized:this.isInitialized,hasPanelElement:!!this.floatingPanel,hasInjectionPoint:!!this.injectionPoint,panelVisible:this.floatingPanel?this.floatingPanel.isVisible:!1}}async refresh(){try{console.log("[PromptLint] Refreshing UI components..."),this.floatingPanel&&(await this.floatingPanel.cleanup(),this.floatingPanel=null),this.isInitialized=!1,await this.initialize(),console.log("[PromptLint] UI components refreshed successfully")}catch(e){throw console.error("[PromptLint] Error refreshing UI components:",e),e}}async cleanup(){try{this.floatingPanel&&(await this.floatingPanel.cleanup(),this.floatingPanel=null),this.injectionPoint=null,this.isInitialized=!1,console.log("[PromptLint] UI injector cleaned up")}catch(e){console.error("[PromptLint] Error during UI injector cleanup:",e)}}}var I=(o=>(o.MISSING_TASK_VERB="missing_task_verb",o.MISSING_LANGUAGE="missing_language",o.MISSING_IO_SPECIFICATION="missing_io_specification",o.VAGUE_WORDING="vague_wording",o.UNCLEAR_SCOPE="unclear_scope",o.REDUNDANT_LANGUAGE="redundant_language",o))(I||{});const ie=["implement","create","build","develop","write","code","generate","explain","describe","analyze","review","document","debug","fix","solve","resolve","troubleshoot","convert","transform","refactor","optimize","improve","test","validate","verify","check","design","plan","outline","demonstrate","provide"],se=["make","do","get","have","use","work","help","give","tell","show","find"];class re{constructor(){this.type=I.MISSING_TASK_VERB,this.name="Missing Task Verb",this.description="Detects prompts without clear action verbs indicating what should be done"}analyze(e){const t=e.toLowerCase().trim();return ie.some(r=>[new RegExp(`^${r}\\b`),new RegExp(`\\b${r}\\b`),new RegExp(`^(please |can you |could you |i need to |i want to |help me )?${r}\\b`)].some(a=>a.test(t)))?{hasIssue:!1,message:""}:se.some(r=>new RegExp(`\\b${r}\\b`).test(t))?{hasIssue:!0,message:'Task verb is unclear - specify a precise action like "implement", "debug", or "explain"',suggestion:"Use specific action verbs: implement, create, debug, explain, analyze, etc."}:{hasIssue:!0,message:"No clear task verb found - specify what action should be taken",suggestion:'Start with a clear action verb like "implement", "create", "debug", or "explain"'}}}const oe=["javascript","js","typescript","ts","python","py","java","c\\+\\+","cpp","c#","csharp","c","go","golang","rust","php","ruby","swift","kotlin","scala","dart","html","css","scss","sass","jsx","tsx","vue","react","angular","bash","shell","powershell","sql","r","matlab","perl","haskell","clojure","lua","assembly","asm","vb","vba","fortran","cobol","ada","erlang","elixir","node","nodejs","deno","bun"],ae=["function","class","method","algorithm","code","script","program","app","application","implementation","library","module","component","service","api","endpoint","quicksort","bubblesort","mergesort","binary search","linked list","tree","graph","database","query","server","client","frontend","backend","fullstack","navbar","navigation","responsive","website","webpage","html","css","dom","unit test","test","testing","spec","mock","stub","system","authentication","auth","login","session","security","debug","fix","error","bug","issue","troubleshoot","do","make","create","build","write","implement"],le=["explain","describe","document","what is","how does","why does","show me","tell me","help me understand","clarify","outline","overview"];class ce{constructor(){this.type=I.MISSING_LANGUAGE,this.name="Missing Programming Language",this.description="Detects code generation requests without specified programming language"}analyze(e){const t=e.toLowerCase().trim();return le.some(s=>t.includes(s.toLowerCase()))?{hasIssue:!1,message:""}:ae.some(s=>t.includes(s.toLowerCase()))?oe.some(s=>[new RegExp(`\\b${s}\\b`,"i"),new RegExp(`\\bin ${s}\\b`,"i"),new RegExp(`\\busing ${s}\\b`,"i"),new RegExp(`\\bwith ${s}\\b`,"i"),new RegExp(`\\b${s} code\\b`,"i"),new RegExp(`\\b${s} function\\b`,"i"),new RegExp(`\\b${s} script\\b`,"i")].some(l=>l.test(t)))?{hasIssue:!1,message:""}:{hasIssue:!0,message:"Programming language not specified for code generation request",suggestion:"Specify the programming language (e.g., Python, JavaScript, Java, C++, etc.)"}:{hasIssue:!1,message:""}}}const pe=["input","parameter","argument","data","array","list","string","number","integer","object","json","csv","file","text","value","variable","field","property","receives","takes","accepts","given","provided","passed"],ue=["output","return","result","response","produce","generate","create","build","sorted","filtered","transformed","formatted","calculated","processed","returns","outputs","produces","yields","gives","provides"],de=["function","method","algorithm","sort","search","filter","transform","convert","parse","process","calculate","compute","analyze","validate","format","returns","endpoint","api","service","component","connection","authentication","do","make","create","build","write","implement"];class me{constructor(){this.type=I.MISSING_IO_SPECIFICATION,this.name="Missing I/O Specification",this.description="Detects prompts without clear input/output format specifications"}analyze(e){const t=e.toLowerCase().trim();if(!de.some(u=>t.includes(u.toLowerCase())))return{hasIssue:!1,message:""};const i=pe.some(u=>[new RegExp(`\\b${u}\\s*:`),new RegExp(`\\b${u}\\s*(is|are|should be)`),new RegExp(`\\btakes?\\s+\\w*\\s*${u}`),new RegExp(`\\binput\\s+${u}`),new RegExp(`\\b${u}\\s+input`),new RegExp(`\\breceives?\\s+\\w*\\s*${u}`),new RegExp(`\\baccepts?\\s+\\w*\\s*${u}`)].some(y=>y.test(t))),r=ue.some(u=>[new RegExp(`\\b${u}\\b`),new RegExp(`\\b${u}\\s*:`),new RegExp(`\\b${u}\\s*(is|are|should be)`),new RegExp(`\\bshould\\s+${u}`)].some(y=>y.test(t))),s=!i,a=!r;if(!s&&!a)return{hasIssue:!1,message:""};let l="",c="";return s&&a?(l="Input and output formats not specified",c='Specify both input format (e.g., "array of integers") and expected output format'):s?(l="Input format not specified",c='Specify the input format (e.g., "array of integers", "string", "JSON object")'):(l="Output format not specified",c='Specify the expected output format (e.g., "sorted array", "boolean", "formatted string")'),{hasIssue:!0,message:l,suggestion:c}}}const he=[{term:"just",replacement:"specifically"},{term:"maybe",replacement:"optionally"},{term:"somehow",replacement:"using a specific method"},{term:"something like",replacement:"similar to"},{term:"kind of",replacement:"type of"},{term:"sort of",replacement:"type of"},{term:"pretty much",replacement:"essentially"},{term:"basically",replacement:"specifically"},{term:"probably",replacement:"likely"},{term:"might",replacement:"could"},{term:"stuff",replacement:"items"},{term:"things",replacement:"elements"},{term:"whatever",replacement:"any appropriate"},{term:"some kind of",replacement:"a specific type of"},{term:"or something",replacement:"or similar"},{term:"and stuff",replacement:"and related items"}],ge=["perhaps","possibly","presumably","supposedly","apparently","seemingly","roughly","approximately","about","around","kinda","sorta"];class fe{constructor(){this.type=I.VAGUE_WORDING,this.name="Vague Wording",this.description="Detects vague terms that make prompts unclear and ambiguous"}analyze(e){const t=[],n=[];for(const{term:a}of he){const l=new RegExp(`\\b${a.replace(/\s+/g,"\\s+")}\\b`,"gi");let c;for(;(c=l.exec(e))!==null;)t.push(a),n.push({start:c.index,end:c.index+c[0].length})}for(const a of ge){const l=new RegExp(`\\b${a}\\b`,"gi");let c;for(;(c=l.exec(e))!==null;)t.push(a),n.push({start:c.index,end:c.index+c[0].length})}if(t.length===0)return{hasIssue:!1,message:""};const s={hasIssue:!0,message:`Vague terms detected: ${[...new Set(t)].map(a=>`"${a}"`).join(", ")}`,suggestion:"Replace vague terms with specific, precise language"};return n.length>0&&(s.position=n[0]),s}}const ye=["everything","anything","all","any","complete","full","entire","whole","comprehensive","total","overall","general","generic","universal"],be=["system","solution","program","app","application","tool","utility","framework","platform","service","component","module","library","bug","issue","problem","error","thing","stuff","it","something","anything"],Ee=["best","good","better","optimal","efficient","fast","simple","easy","nice","clean","proper","correct","right","appropriate","suitable"],Ie=["this","that","these","those","the above","the following"],we=["only","just","specifically","exactly","precisely","limited to","excluding","without","except","focus on","concentrate on","single","one","basic","minimal","simple version"];class _e{constructor(){this.type=I.UNCLEAR_SCOPE,this.name="Unclear Scope",this.description="Detects prompts with undefined or overly broad task boundaries"}analyze(e){const t=e.toLowerCase().trim(),n=[];ye.some(p=>[new RegExp(`\\b${p}\\b`),new RegExp(`\\bthe ${p}\\b`),new RegExp(`\\ban? ${p}\\b`)].some(g=>g.test(t)))&&n.push("overly broad scope");const r=be.some(p=>new RegExp(`\\b${p}\\b`).test(t)),s=we.some(p=>new RegExp(`\\b${p}\\b`).test(t)),a=["merge sort","quicksort","binary search","linked list","binary tree","hash table","stack","queue","graph","fibonacci","factorial"].some(p=>t.includes(p.toLowerCase()));r&&!s&&!a&&n.push("vague task descriptor without scope clarification");const l=Ee.some(p=>[new RegExp(`\\bmake it ${p}\\b`),new RegExp(`\\bshould be ${p}\\b`),new RegExp(`\\bneeds to be ${p}\\b`),new RegExp(`\\bhas to be ${p}\\b`)].some(g=>g.test(t))),c=Ie.some(p=>p==="that"?[/\bdebug that\b/,/\bfix that\b/,/\boptimize that\b/,/\bimprove that\b/,/\bupdate that\b/,/\bthat\s+(bug|error|issue|problem)\b/].some(g=>g.test(t)):new RegExp(`\\b${p}\\b`).test(t));l&&n.push("unclear quality requirements"),c&&n.push("vague references");const u=t.split(/\s+/).filter(p=>p.length>0),m=["quicksort","bubblesort","mergesort","binary search","factorial","fibonacci"].some(p=>t.includes(p.toLowerCase()));return u.length<=2&&!s&&!m&&n.push("insufficient detail for scope definition"),n.length===0?{hasIssue:!1,message:""}:{hasIssue:!0,message:`Task scope unclear: ${n.join(", ")}`,suggestion:"Define specific boundaries for what should be included/excluded in the task"}}}const Te=["really","very","quite","rather","pretty","fairly","somewhat","actually","basically","essentially","literally","definitely","absolutely","totally","completely","entirely","obviously","clearly","certainly","surely"],Le=[{phrase:"in order to",replacement:"to"},{phrase:"due to the fact that",replacement:"because"},{phrase:"at this point in time",replacement:"now"},{phrase:"for the purpose of",replacement:"to"},{phrase:"with regard to",replacement:"regarding"},{phrase:"in the event that",replacement:"if"},{phrase:"it is important to note that",replacement:""},{phrase:"please note that",replacement:""},{phrase:"i would like to",replacement:"i want to"},{phrase:"could you please",replacement:"please"},{phrase:"would you mind",replacement:"please"},{phrase:"if you could",replacement:"please"}],xe=[{expression:"make use of",replacement:"use"},{expression:"give consideration to",replacement:"consider"},{expression:"put emphasis on",replacement:"emphasize"},{expression:"take into account",replacement:"consider"},{expression:"come to the conclusion",replacement:"conclude"},{expression:"make a decision",replacement:"decide"},{expression:"carry out",replacement:"do"},{expression:"bring to completion",replacement:"complete"}];class Ce{constructor(){this.type=I.REDUNDANT_LANGUAGE,this.name="Redundant Language",this.description="Detects unnecessary repetition, filler words, and verbose expressions"}analyze(e){const t=e.toLowerCase().trim(),n=[];let i=0;const r=Te.filter(d=>{const g=new RegExp(`\\b${d}\\b`,"g"),_=t.match(g);return _&&_.length>0});r.length>0&&(n.push(`filler words: ${r.slice(0,3).join(", ")}`),i+=r.length);const s=Le.filter(({phrase:d})=>t.includes(d.toLowerCase()));s.length>0&&(n.push("redundant phrases"),i+=s.length);const a=xe.filter(({expression:d})=>t.includes(d.toLowerCase()));a.length>0&&(n.push("verbose expressions"),i+=a.length);const l=t.split(/\s+/).filter(d=>d.length>3),c={};l.forEach(d=>{c[d]=(c[d]||0)+1});const u=Object.entries(c).filter(([d,g])=>g>2).map(([d])=>d);u.length>0&&(n.push("repeated words"),i+=u.length);const y=["please","thank you","thanks","appreciate","grateful"].reduce((d,g)=>{const _=t.match(new RegExp(`\\b${g}\\b`,"g"));return d+(_?_.length:0)},0);return y>2&&(n.push("excessive courtesy language"),i+=y-2),n.length===0?{hasIssue:!1,message:""}:i<2&&s.length===0?{hasIssue:!1,message:""}:{hasIssue:!0,message:`Redundant language detected: ${n.slice(0,2).join(", ")}`,suggestion:"Remove unnecessary words and simplify expressions for clarity"}}}function ve(){return[new re,new ce,new me,new fe,new _e,new Ce]}function Pe(o,e,t){let n=e.baseScore;for(const i of o)switch(i.severity){case"high":n-=e.highSeverityPenalty;break;case"medium":n-=e.mediumSeverityPenalty;break;case"low":n-=e.lowSeverityPenalty;break}return t&&(n+=Ne(t,e)),Math.max(0,Math.min(100,n))}function Ne(o,e){const t=o.toLowerCase().trim();let n=0;if(e.taskVerbQualityBonus){const i=["implement","develop","architect","construct","engineer"],r=["build","create","generate","design","code","program"];i.some(s=>t.includes(s))?n+=e.taskVerbQualityBonus:r.some(s=>t.includes(s))&&(n+=Math.round(e.taskVerbQualityBonus*.6))}if(e.specificityBonus){const r=["algorithm","function","method","class","module","component"].filter(s=>t.includes(s));r.length>0&&(n+=e.specificityBonus,r.length>1&&(n+=Math.round(e.specificityBonus*.5*(r.length-1))))}if(e.clarityBonus){const r=[{pattern:" with ",desc:"with clause"},{pattern:" that ",desc:"that clause"},{pattern:" for ",desc:"for clause"},{pattern:"input",desc:"input specification"},{pattern:"output",desc:"output specification"},{pattern:"return",desc:"return specification"}].filter(s=>t.includes(s.pattern));n+=Math.round(e.clarityBonus*r.length*.3),t.length>30&&t.split(" ").length>=6&&(n+=Math.round(e.clarityBonus*.5))}return n}const Ae={rules:[{type:"missing_task_verb",enabled:!0,severity:"medium"},{type:"missing_language",enabled:!0,severity:"high"},{type:"missing_io_specification",enabled:!0,severity:"medium"},{type:"vague_wording",enabled:!0,severity:"medium"},{type:"unclear_scope",enabled:!0,severity:"medium"},{type:"redundant_language",enabled:!0,severity:"low"}],scoring:{baseScore:100,highSeverityPenalty:43,mediumSeverityPenalty:23,lowSeverityPenalty:12,taskVerbQualityBonus:5,specificityBonus:3,clarityBonus:2},performance:{maxProcessingTime:50}};class Se{constructor(e={}){this.config={...Ae,...e},this.rules=ve()}analyze(e){const t=[],n=[];for(const s of this.rules){const a=this.config.rules.find(l=>l.type===s.type);if(!(!a||!a.enabled))try{const l=s.analyze(e);if(l.hasIssue){const c={type:s.type,severity:a.severity,message:l.message};l.position&&(c.position=l.position),t.push(c)}l.suggestion&&n.push(l.suggestion)}catch(l){console.warn(`Rule ${s.type} failed:`,l)}}const r={score:Pe(t,this.config.scoring,e),issues:t};return n.length>0&&(r.suggestions=n),r}getConfig(){return{...this.config}}updateConfig(e){this.config={...this.config,...e}}}function R(o){const e=performance.now();if(!o||typeof o!="string")return{score:0,issues:[],suggestions:["Please provide a valid prompt text"],metadata:{processingTime:performance.now()-e,inputLength:0,timestamp:new Date}};const t=o.trim();if(t.length===0)return{score:0,issues:[],suggestions:["Please provide a non-empty prompt"],metadata:{processingTime:performance.now()-e,inputLength:0,timestamp:new Date}};const i=new Se().analyze(t);return i.metadata={processingTime:performance.now()-e,inputLength:t.length,timestamp:new Date},i}var f=(o=>(o.SITE_DETECTION_FAILED="SITE_DETECTION_FAILED",o.ADAPTER_NOT_FOUND="ADAPTER_NOT_FOUND",o.ADAPTER_INITIALIZATION_FAILED="ADAPTER_INITIALIZATION_FAILED",o.DOM_INJECTION_FAILED="DOM_INJECTION_FAILED",o.INPUT_ELEMENT_NOT_FOUND="INPUT_ELEMENT_NOT_FOUND",o.UI_INJECTION_POINT_NOT_FOUND="UI_INJECTION_POINT_NOT_FOUND",o.LINT_ANALYSIS_FAILED="LINT_ANALYSIS_FAILED",o.PANEL_CREATION_FAILED="PANEL_CREATION_FAILED",o.PERMISSION_DENIED="PERMISSION_DENIED",o.NETWORK_ERROR="NETWORK_ERROR",o.UNKNOWN_ERROR="UNKNOWN_ERROR",o))(f||{});class Re{options;errorLog=[];retryAttempts=new Map;constructor(e={}){this.options={enableLogging:e.enableLogging!==!1,enableUserNotifications:e.enableUserNotifications!==!1,maxRetries:e.maxRetries||3,retryDelayMs:e.retryDelayMs||1e3}}handleError(e,t,n){const i=this.createPromptLintError(e,t,n);return this.options.enableLogging&&this.logError(i),this.errorLog.push(i),this.errorLog.length>50&&this.errorLog.shift(),this.reportToBackground(i),i}createPromptLintError(e,t,n){const i=e instanceof Error?e:new Error(e),r=t||this.categorizeError(i);return{type:r,message:i.message,originalError:i,context:n||{},timestamp:Date.now(),recoverable:this.isRecoverable(r),userMessage:this.getUserMessage(r),suggestion:this.getSuggestion(r)}}categorizeError(e){const t=e.message.toLowerCase();return t.includes("site")&&t.includes("detect")?"SITE_DETECTION_FAILED":t.includes("adapter")&&t.includes("not found")?"ADAPTER_NOT_FOUND":t.includes("input")&&t.includes("element")?"INPUT_ELEMENT_NOT_FOUND":t.includes("injection")||t.includes("dom")?"DOM_INJECTION_FAILED":t.includes("permission")?"PERMISSION_DENIED":t.includes("network")||t.includes("fetch")?"NETWORK_ERROR":t.includes("analyze")||t.includes("lint")?"LINT_ANALYSIS_FAILED":"UNKNOWN_ERROR"}isRecoverable(e){return["INPUT_ELEMENT_NOT_FOUND","UI_INJECTION_POINT_NOT_FOUND","DOM_INJECTION_FAILED","LINT_ANALYSIS_FAILED","NETWORK_ERROR"].includes(e)}getUserMessage(e){return{SITE_DETECTION_FAILED:"Unable to detect supported AI website",ADAPTER_NOT_FOUND:"Website adapter not available",ADAPTER_INITIALIZATION_FAILED:"Failed to initialize website integration",DOM_INJECTION_FAILED:"Unable to inject PromptLint interface",INPUT_ELEMENT_NOT_FOUND:"Cannot find text input field",UI_INJECTION_POINT_NOT_FOUND:"Cannot find suitable location for PromptLint panel",LINT_ANALYSIS_FAILED:"Prompt analysis temporarily unavailable",PANEL_CREATION_FAILED:"Unable to create PromptLint panel",PERMISSION_DENIED:"Extension permissions insufficient",NETWORK_ERROR:"Network connection issue",UNKNOWN_ERROR:"An unexpected error occurred"}[e]||"Unknown error occurred"}getSuggestion(e){return{SITE_DETECTION_FAILED:"Make sure you're on ChatGPT or Claude website",ADAPTER_NOT_FOUND:"Try refreshing the page or check if site is supported",INPUT_ELEMENT_NOT_FOUND:"Navigate to the chat interface and try again",PERMISSION_DENIED:"Check extension permissions in Chrome settings",NETWORK_ERROR:"Check your internet connection and try again",UNKNOWN_ERROR:"Try refreshing the page or restarting the browser"}[e]}async attemptRecovery(e,t,n){const i=`${t}_${JSON.stringify(n||{})}`,r=this.retryAttempts.get(i)||0;if(r>=this.options.maxRetries)return console.warn(`[PromptLint] Max retries exceeded for ${t}`),null;try{const s=await e();return this.retryAttempts.delete(i),s}catch(s){const a=r+1;if(this.retryAttempts.set(i,a),this.handleError(s,t,{...n,attempt:a,maxRetries:this.options.maxRetries}).recoverable&&a<this.options.maxRetries){console.log(`[PromptLint] Retrying ${t} (attempt ${a}/${this.options.maxRetries})`);const c=this.options.retryDelayMs*Math.pow(2,a-1);return await this.sleep(c),this.attemptRecovery(e,t,n)}return null}}createErrorLintResult(e){return{score:0,issues:[{type:"system_error",severity:"high",message:e.userMessage,suggestion:e.suggestion||"Please try again or contact support"}],metadata:{processingTime:0,rulesApplied:[],error:{type:e.type,recoverable:e.recoverable,timestamp:e.timestamp}}}}logError(e){const t=`[PromptLint Error] ${e.type}: ${e.message}`,n={error:e.originalError,context:e.context,recoverable:e.recoverable,timestamp:new Date(e.timestamp).toISOString()};e.recoverable?console.warn(t,n):console.error(t,n)}reportToBackground(e){try{chrome.runtime.sendMessage({type:"ERROR_REPORT",error:{type:e.type,message:e.message,timestamp:e.timestamp,recoverable:e.recoverable,context:e.context}}).catch(()=>{})}catch{}}getErrorStats(){const e={};let t=0;return this.errorLog.forEach(n=>{e[n.type]=(e[n.type]||0)+1,n.recoverable&&t++}),{totalErrors:this.errorLog.length,recoverableErrors:t,errorsByType:e,recentErrors:this.errorLog.slice(-10)}}clearErrorLog(){this.errorLog=[],this.retryAttempts.clear()}sleep(e){return new Promise(t=>setTimeout(t,e))}}const h=new Re({enableLogging:!0,enableUserNotifications:!0,maxRetries:3,retryDelayMs:1e3});class Oe{adapter;uiInjector;options;currentInputElement=null;debounceTimer=null;lastAnalyzedText="";isMonitoring=!1;constructor(e,t,n={}){this.adapter=e,this.uiInjector=t,this.options={debounceMs:n.debounceMs||300,minLength:n.minLength||3,maxLength:n.maxLength||5e3}}async initialize(){try{console.log("[PromptLint] Initializing input monitor...");const e=await this.adapter.findInputElement();if(!e.element){console.warn("[PromptLint] No input element found");return}this.currentInputElement=e.element,console.log("[PromptLint] Found input element:",e.selectorUsed),this.startMonitoring(),console.log("[PromptLint] Input monitor initialized successfully")}catch(e){throw console.error("[PromptLint] Failed to initialize input monitor:",e),e}}startMonitoring(){!this.currentInputElement||this.isMonitoring||(this.isMonitoring=!0,this.currentInputElement.tagName.toLowerCase()==="textarea"||this.currentInputElement.tagName.toLowerCase()==="input"?(this.currentInputElement.addEventListener("input",this.handleInputChange.bind(this)),this.currentInputElement.addEventListener("paste",this.handleInputChange.bind(this))):this.currentInputElement.getAttribute("contenteditable")==="true"&&(this.currentInputElement.addEventListener("input",this.handleInputChange.bind(this)),this.currentInputElement.addEventListener("paste",this.handleInputChange.bind(this)),new MutationObserver(()=>{this.handleInputChange()}).observe(this.currentInputElement,{childList:!0,subtree:!0,characterData:!0})),console.log("[PromptLint] Started monitoring input changes"))}handleInputChange(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=window.setTimeout(()=>{this.processInputChange()},this.options.debounceMs)}async processInputChange(){try{if(!this.currentInputElement)return;const e=this.extractTextContent();if(e===this.lastAnalyzedText||e.length<this.options.minLength||e.length>this.options.maxLength)return;this.lastAnalyzedText=e,console.log("[PromptLint] Analyzing input:",e.substring(0,50)+"...");const t=await h.attemptRecovery(async()=>{const n=performance.now(),i=R(e),r=performance.now()-n;return console.log(`[PromptLint] Analysis completed in ${r.toFixed(2)}ms:`,{score:i.score,issues:i.issues.length}),i},f.LINT_ANALYSIS_FAILED,{textLength:e.length,inputType:this.currentInputElement.tagName.toLowerCase()});if(t)await this.uiInjector.updateResults(t);else{const n=h.handleError("Lint analysis failed after multiple attempts",f.LINT_ANALYSIS_FAILED,{textLength:e.length}),i=h.createErrorLintResult(n);await this.uiInjector.updateResults(i)}}catch(e){const t=h.handleError(e,f.LINT_ANALYSIS_FAILED,{phase:"input_processing",textLength:this.lastAnalyzedText.length}),n=h.createErrorLintResult(t);await this.uiInjector.updateResults(n)}}extractTextContent(){return this.currentInputElement?this.currentInputElement.tagName.toLowerCase()==="textarea"||this.currentInputElement.tagName.toLowerCase()==="input"?this.currentInputElement.value.trim():this.currentInputElement.getAttribute("contenteditable")==="true"&&this.currentInputElement.textContent?.trim()||"":""}async refreshInputElement(){try{console.log("[PromptLint] Refreshing input element..."),this.stopMonitoring();const e=await this.adapter.findInputElement();return e.element?(this.currentInputElement=e.element,this.lastAnalyzedText="",this.startMonitoring(),console.log("[PromptLint] Input element refreshed successfully"),!0):(console.warn("[PromptLint] No input element found during refresh"),!1)}catch(e){return console.error("[PromptLint] Failed to refresh input element:",e),!1}}stopMonitoring(){if(this.isMonitoring){if(this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null),this.currentInputElement){const e=this.currentInputElement.cloneNode(!0);this.currentInputElement.parentNode?.replaceChild(e,this.currentInputElement)}this.isMonitoring=!1,console.log("[PromptLint] Stopped monitoring input changes")}}async analyzeNow(){try{const e=this.extractTextContent();if(e.length<this.options.minLength)return null;const t=R(e);return await this.uiInjector.updateResults(t),t}catch(e){return console.error("[PromptLint] Error in immediate analysis:",e),null}}getStatus(){return{isMonitoring:this.isMonitoring,hasInputElement:!!this.currentInputElement,lastAnalyzedText:this.lastAnalyzedText,debounceMs:this.options.debounceMs}}async cleanup(){try{this.stopMonitoring(),this.currentInputElement=null,this.lastAnalyzedText="",console.log("[PromptLint] Input monitor cleaned up")}catch(e){console.error("[PromptLint] Error during input monitor cleanup:",e)}}}class De{uiInjector=null;inputMonitor=null;isInitialized=!1;async initialize(){if(this.isInitialized){console.log("[PromptLint] Already initialized");return}try{console.log("[PromptLint] Initializing content script...");const e=await h.attemptRecovery(async()=>{const s=v.detectSite();if(!s||s.confidence<.7)throw new Error("Site not supported or confidence too low");return s},f.SITE_DETECTION_FAILED,{url:window.location.href});if(!e){console.log("[PromptLint] Site detection failed after retries");return}if(console.log("[PromptLint] Site detection result:",e),!await h.attemptRecovery(async()=>(await te(),!0),f.ADAPTER_INITIALIZATION_FAILED,{phase:"site_adapters_init"})){console.error("[PromptLint] Failed to initialize site adapters");return}console.log("[PromptLint] Site adapters initialized"),console.log("[PromptLint] Registered adapters:",C.getRegisteredSiteTypes()),console.log("[PromptLint] Looking for adapter for site type:",e.type);const n=await h.attemptRecovery(async()=>{const s=C.getAdapterByType(e.type);if(console.log("[PromptLint] Found adapter:",!!s),!s)throw new Error(`No adapter found for site type: ${e.type}`);return s},f.ADAPTER_NOT_FOUND,{siteType:e.type});if(!n){console.error("[PromptLint] Failed to get adapter after retries");return}if(await h.attemptRecovery(async()=>(await n.performInitialization(),!0),f.ADAPTER_INITIALIZATION_FAILED,{siteType:e.type}),console.log("[PromptLint] Site adapter initialized"),!await h.attemptRecovery(async()=>(this.uiInjector=new ne(n),await this.uiInjector.initialize(),!0),f.DOM_INJECTION_FAILED,{siteType:e.type})){console.error("[PromptLint] Failed to initialize UI components");return}const r=await h.attemptRecovery(async()=>(this.inputMonitor=new Oe(n,this.uiInjector),await this.inputMonitor.initialize(),!0),f.INPUT_ELEMENT_NOT_FOUND,{siteType:e.type});r||console.error("[PromptLint] Failed to initialize input monitor"),this.isInitialized=!0,console.log("[PromptLint] Content script initialized successfully");try{chrome.runtime.sendMessage({type:"CONTENT_SCRIPT_READY",site:e.type,confidence:e.confidence,hasInputMonitor:!!r})}catch(s){console.warn("[PromptLint] Could not send ready message to background:",s)}}catch(e){const t=h.handleError(e,f.UNKNOWN_ERROR,{phase:"initialization",url:window.location.href});if(console.error("[PromptLint] Failed to initialize content script:",t),this.uiInjector){const n=h.createErrorLintResult(t);await this.uiInjector.updateResults(n)}}}async cleanup(){try{this.inputMonitor&&(await this.inputMonitor.cleanup(),this.inputMonitor=null),this.uiInjector&&(await this.uiInjector.cleanup(),this.uiInjector=null);const e=C.getAdapterForCurrentSite();e&&await e.performCleanup(),this.isInitialized=!1,console.log("[PromptLint] Content script cleaned up")}catch(e){console.error("[PromptLint] Error during cleanup:",e)}}}const E=new De;document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{E.initialize()}):E.initialize();let O=window.location.href;const U=new MutationObserver(()=>{window.location.href!==O&&(O=window.location.href,console.log("[PromptLint] URL changed, reinitializing..."),E.cleanup().then(()=>{setTimeout(()=>E.initialize(),1e3)}))});U.observe(document.body,{childList:!0,subtree:!0});window.addEventListener("beforeunload",()=>{E.cleanup(),U.disconnect()});chrome.runtime.onMessage.addListener((o,e,t)=>{switch(o.type){case"GET_STATUS":t({initialized:E.isInitialized,site:v.detectSite()?.type||null});break;case"REINITIALIZE":E.cleanup().then(()=>E.initialize()),t({success:!0});break}});
